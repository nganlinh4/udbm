<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Loading uDBM...</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            background: transparent !important; /* no background */
            -webkit-font-smoothing: antialiased;
            -webkit-text-size-adjust: 100%;
        }
        body {
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden; user-select: none;
        }
        .splash-container { display: flex; justify-content: center; align-items: center; width: 100%; height: 100%; background: transparent !important; }
        .svg-container { position: relative; width: 400px; height: 400px; display: flex; justify-content: center; align-items: center; background: transparent !important; }
        #splash-svg { width: 100%; height: 100%; background: none !important; }
        /* Ensure per-path transforms use their own boxes */
        #splash-svg path { transform-box: fill-box; transform-origin: center; will-change: transform; }
        /* Respect reduced motion */
        @media (prefers-reduced-motion: reduce) {
            #splash-svg path { animation: none !important; transition: none !important; }
        }
    </style>
</head>
<body>
    <div class="splash-container">
        <div class="svg-container"><!-- SVG will be loaded here --></div>
    </div>

    <script>
        // Load and animate SVG
        async function loadSVG() {
            try {
                const response = await fetch('./splash.svg');
                const svgText = await response.text();
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgText, 'image/svg+xml');
                const svgElement = svgDoc.querySelector('svg');
                if (svgElement) {
                    svgElement.id = 'splash-svg';
                    document.querySelector('.svg-container').appendChild(svgElement);
                    animatePaths();
                }
            } catch (error) {
                console.error('Error loading SVG:', error);
                createFallbackLogo();
            }
        }

        function animatePaths() {
            const svg = document.getElementById('splash-svg');
            if (!svg) return;
            const paths = Array.from(svg.querySelectorAll('path'));

            // Respect reduced-motion, unless explicitly overridden via ?anim=on
            const forceAnim = new URLSearchParams(location.search).get('anim') === 'on';
            if (!forceAnim && window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                paths.forEach(p => p.style.transform = 'scale(1)');
                return;
            }

            // Disable any CSS animations â€” JS fully controls transforms here
            paths.forEach((p) => (p.style.animation = 'none'));

            // Grow-in parameters
            const durationMs = 2500; // total time for the grow animation
            const minScale = 0.15;   // starting scale (15%)
            const easeOutCubic = (x) => 1 - Math.pow(1 - x, 3);

            const t0 = performance.now();
            function growTick(now) {
                const raw = Math.min(1, Math.max(0, (now - t0) / durationMs));
                const e = easeOutCubic(raw);
                const s = (minScale + (1 - minScale) * e).toFixed(4);

                for (const p of paths) p.style.transform = `scale(${s})`;

                if (raw < 1) {
                    requestAnimationFrame(growTick);
                } else {
                    // Start subtle breathing pulse after reaching full size
                    startBreathing(paths);
                }
                    try { window.electronSplashDone && window.electronSplashDone(); } catch (e) {}
            }
            requestAnimationFrame(growTick);

            function startBreathing(targetPaths) {
                const amp = 0.015; // +/-1.5% breathing
                const freq = 0.5;  // Hz (2s per cycle)
                const tStart = performance.now();
                function breatheTick(now) {
                    const t = (now - tStart) / 1000; // seconds
                    const s = (1 + amp * Math.sin(2 * Math.PI * freq * t)).toFixed(4);
                    for (const p of targetPaths) p.style.transform = `scale(${s})`;
                    requestAnimationFrame(breatheTick);
                }
                requestAnimationFrame(breatheTick);
            }
        }

        function createFallbackLogo() {
            const container = document.querySelector('.svg-container');
            container.innerHTML = `
                <div style="font-size:72px;font-weight:bold;color:#fff;animation:levitate 4s ease-in-out infinite;">uDBM</div>
            `;
        }

        document.addEventListener('DOMContentLoaded', loadSVG);
    </script>
</body>
</html>
